{% extends 'doc_base.html' %}

{% block title %}
  Inferencia con modelo {{modelo.nombre}}
{% endblock %}

{% block content %}
  <div class="container">
    <div class="row">
      <div class="card p-4 shadow">
          <div class="col-md-6 offset-md-3">
            <h3 class="mt-4 mb-3 text-dark font-weight-bold">Realizar inferencia con modelo {{modelo.nombre}}</h3>
              <p class="text-dark font-italic">{{modelo.descripcion}}</p>
              <!-- barra de progreso mientras se realiza la inferencia -->
            {% if not ocultar_barra_progreso %}
            <div id="progress-container" class="progress mb-4 hidden">
              <div id="progress-bar" class="progress-bar progress-bar-striped" role="progressbar" style="width: 60%;" aria-valuenow="60" aria-valuemin="60" aria-valuemax="100"></div>
              <div class="progress-bar-inner"></div>
              <span class="progress-text">Analizando la imagen...</span>
            </div>
            {% endif %}
            <form method="POST" action="/inferir_con_modelo" enctype="multipart/form-data" class="needs-validation" novalidate>
              <div class="mb-3">
                <label for="color-input" class="form-label">Seleccione color para marcar el resultado:</label>
                <input type="text" id="color-input" name="color-input" class="form-control" value="#FFFFFF">
              </div>
              <div class="mb-3">
                <label for="image" class="form-label">Seleccione una imagen:</label>
                  <input type="file" id="image" name="image" class="form-control-file" required>
                  <div class="invalid-feedback">Por favor, seleccione una imagen.</div>
              </div>
              <button id="submit-button" type="submit" class="btn btn-secondary btn-lg btn-block">Presentar al modelo</button>
            </form>

            <!-- -->
            {% if prediction %}
              <h2 class="mt-4">Resultado de la clasificaci√≥n:</h2>
            <div class="form-text custom-bg-yellow p-2 rounded">
              {% if resultado %}{{ resultado }}{% endif %}
            </div>
              <div class="container">
                <div class="card mt-4">
                  <img src="data:image/png;base64,{{ prediction }}" class="card-img-top img-fluid rounded mx-auto d-block">
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
  </div>
  <script>
      document.getElementById('submit-button').addEventListener('click', function() {
        var progressBar = document.getElementById('progress-bar');
        progressBar.classList.remove('hidden');
      });

    // Control para seleccion de color en la inferencia
    $(document).ready(function() {
      $('#color-input').colorpicker();
  });

  </script>

{% endblock %}
